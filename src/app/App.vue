<template>
  <v-app id="inspire" :theme="theme" >
    <Navbar @themeToggled="toggleTheme" :theme="theme"/>
    <RouterView  />
    <div v-if="loading">
      <v-progress-circular indeterminate color="primary"></v-progress-circular>
    </div>
  </v-app>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { Navbar } from '../widgets/Navbar';
import { useUserStore } from './stores/userStore'
import LoadingSpinner from '../shared/ui/LoadinSpinner/LoadingSpinner.vue'
import ErrorComponent from '../shared/ui/ErrorComponent/ErrorComponent.vue'

const theme = ref('light')
const userStore = useUserStore()
const loading = ref(true)

function toggleTheme() {
  theme.value = theme.value === 'light' ? 'dark' : 'light'
}

onMounted(() => {
  if (localStorage.getItem('currentUser')) {
    userStore.setUser(JSON.parse(localStorage.getItem('currentUser')))
    userStore.setIsAuth(true)
    if (userStore.user.role === 'admin') {
      userStore.setIsAdmin(true)
    }
  }
  if (localStorage.getItem('userCart')) {
    userStore.setUserCart(JSON.parse(localStorage.getItem('userCart')))
  }
  loading.value = false
})

</script>


<style >
a {
  text-decoration: none;
}


</style>
